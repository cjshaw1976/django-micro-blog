{% extends "base.html" %}
{% load static %}


{% block content %}
<h1>Login Page</h1>

<div class="row vertical-center">
    <div class="col-sm-6 col-sm-offset-3">
      <div class="panel panel-success">
        <div class="panel-heading">
          <h3 class="panel-title">Sign In</h3>
        </div>
        <div class="panel-body">
          <div class="col-xs-8 col-xs-offset-2">
            <div id="errorText" class="text-center alert "></div>
            <form id="frmUserName">
              {% csrf_token %}
              <div id="userNameInput" class="form-group">
                <div class="input-group">
                    <span class="input-group-addon transparent"><span class="glyphicon glyphicon-user"></span></span>
                    <input id="username" class="form-control left-border-none" placeholder="User Name" type="text" name="username" autocomplete="off">
                </div>
              </div>
              <div id="memorableInput" class="form-group hide">
                <div class="input-group">
                  <p class="text-center">x, y and y letters of your memorable word</p>
                  <div class="col-xs-4">
                    <input id="memOne" class="form-control onecharonly" type="text" name="memOne" autocomplete="off">
                  </div>
                  <div class="col-xs-4">
                    <input id="memTwo" class="form-control onecharonly" type="text" name="memTwo" autocomplete="off">
                  </div>
                  <div class="col-xs-4">
                    <input id="memThr" class="form-control onecharonly" type="text" name="memThr" autocomplete="off">
                  </div>
                </div>
              </div>
              <div class="form-group">
                <button id="btnContinue" class="btn btn-large btn-block btn-success" type="submit">Continue</button>
              </div>
            </form>
            <hr>
            <p class="text-center">New User?</p>
            <a href="{% url 'user_new' %}" class="btn btn-large btn-default btn-block">Sign Up</a>
          </div>
        </div>
      </div>
    </div>
</div>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function(event) {
    var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();

    $("#frmUserName").on('submit', function(e){
      e.preventDefault();
      if ($('#username').val()){
        var formData = $('#frmUserName').serializeArray();
        $('#errorText').text('.');
        $('#errorText').removeClass('alert-danger');

        $.post('{% url 'user_login_name_check' %}' ,formData, function(data, status){
          if (data.exists == false){
            $('#errorText').text('User does not exist.');
            $('#errorText').addClass('alert-danger');
          } else {
            $('#userNameInput').hide();
            $('#memorableInput').show();
          }

        });
      } else {
        $('#errorText').text('Enter a user name.');
        $('#errorText').addClass('alert-danger');
      }
    });

    // Select all text in box on focus
    $('.onecharonly').on('click', function () {
       $(this).select();
    });

    // Only allow one char in text box and select after keypress
    $('.onecharonly').bind('keydown', function(event) {
      if (event.key.length === 1) {
        event.preventDefault();
        $(this).val(event.key);
      }
      $(this).select();
    });

  });
</script>
{% endblock %}
